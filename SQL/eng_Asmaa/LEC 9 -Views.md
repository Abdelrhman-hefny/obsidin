
# :-) ุงูู ูู ุงูู View ูููู ูุณุชุฎุฏููุ

- ุงูู **View** ูู **ุฌุฏูู ูููู (Virtual Table)**.
- ูุนูู ูู **ูุด ุจูุฎุฒู ุจูุงูุงุช ุจููุณู**ุ ูููู ุจูุนุฑุถ ูุชูุฌุฉ ุงุณุชุนูุงู (Query) ูุญููุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช.
- ูู ูุฑุฉ ุชูุงุฏู ุนูู ุงูู Viewุ ุงูุณูุฑูุฑ ุจูุฑูุญ ูุดุบู ุงูุงุณุชุนูุงู ุงููู ุฌูุงู ููุฑุฌุนูู ุงููุชูุฌุฉ.

---

1. **ุชุจุณูุท ุงูุงุณุชุนูุงูุงุช ุงููุนูุฏุฉ**
    - ูู ุนูุฏู ูููุฑู ุทููู ููุนูุฏ ุจููุตู ุจูุงูุงุช ูู ูุฐุง ุฌุฏูู (JOINs)ุ ูููู ุชุฎุฒูู ูู View ูุชุณุชุฎุฏูู ูุฃูู ุฌุฏูู ุนุงุฏู.
    - ูุฏู ุจุฏู ูุง ุชุนูุฏ ูุชุงุจุฉ ุงููููุฑู ูู ูุฑุฉุ ูุชูุงุฏู ุนูู ุงูู View ูุฎูุงุต.
        
2. **ุงููุตู ุจูู ุงููุณุชุฎุฏู ูุงูุฌุฏุงูู ุงูุฃุตููุฉ (Security Layer)**
    - ุงููุณุชุฎุฏู ูููู ูุดูู View ูู ุบูุฑ ูุง ูุนุฑู ุฃุณูุงุก ุฃู ุชูุงุตูู ุงูุฌุฏุงูู ุงูุญููููุฉ.
    - ุฏู ุจูุฒูุฏ ุงูุฃูุงู (ุชูุฏุฑ ุชุฎูู ุงููุณุชุฎุฏู ูุดูู ุฃุนูุฏุฉ ูุญุฏุฏุฉ ููุท).
        
3. **ุฅุนุงุฏุฉ ุงูุงุณุชุฎุฏุงู (Reusability)**
    - ุจุฏู ูุง ุชูุฑุฑ ููุณ ุงูุงุณุชุนูุงู ูู ูุฐุง ููุงูุ ุชูุชุจู ูุฑุฉ ูุงุญุฏุฉ ูุชุฎุฒูู ูู View.
        
4. **ูุฑููุฉ ุงูุชุบููุฑ (Flexibility)**
    - ูู ุบูุฑุช ุงููููุฑู ุฏุงุฎู ุงูู Viewุ ุงูุชุทุจููุงุช ุงููู ุจุชุณุชุฎุฏูู ูุด ูุชุชุฃุซุฑุ ูุฃููุง ูุณู ุดุงููุงู ูุฃูู ุฌุฏูู ุซุงุจุช.
        
5. **ุชุญุณูู ุงูุฃุฏุงุก 
    - ุงูู View ุงูุนุงุฏู ูุด ุจูุฎุฒู ุจูุงูุงุช โ ููู ูุฑุฉ ุจูุฑูุญ ูุฌูุจูุง ูู ุงูุฌุฏุงูู.
    - ููู ูู ุญุงูุฉ ุฎุงุตุฉ ุงุณููุง **Indexed View** (ููุง ุชุนูู ููุฑุณ ุนููู) ุงูุจูุงูุงุช ุจุชุชุฎุฒู ูุนูุงู ุฌูุงูุ ูุฏู ูููู ูุณุฑุน ุงูุฃุฏุงุก ูู ุจุนุถ ุงูุญุงูุงุช.
        
---
###  ุงูุชู ุฃุณุชุฎุฏู ุงูู Viewุ

- ููุง ุชุญุจ **ุชุฎูู ุงูุชูุงุตูู** ุนู ุงููุณุชุฎุฏู (ุฒู ุฃุณูุงุก ุงูุฌุฏุงูู ุฃู ุงูุฃุนูุฏุฉ).
- ููุง ุชุญุชุงุฌ **ูุงุฌูุฉ ูุจุณุทุฉ** ูููุตูู ููุจูุงูุงุช ุจุฏู ูุชุงุจุฉ ุงุณุชุนูุงูุงุช ุทูููุฉ ููุนูุฏุฉ.
- ููุง ุนูุฏู **ุตูุงุญูุงุช** ูุนุงูุฒ ุงููุณุชุฎุฏู ูุดูู ุจูุงูุงุช ูุนููุฉ ุจุณ (ูุซูุงู ุงูุทูุงุจ ูู ุงููุงูุฑุฉ ุจุณ).
- ููุง ุงูุชุทุจูู ูุญุชุงุฌ **ุซุจุงุช ูู ุงูุจููุฉ** ุญุชู ูู ุบูุฑุช ุงููููุฑู ุงูุฏุงุฎูู.
- ูู ุญุงูุงุช ุชุญุณูู ุงูุฃุฏุงุก ุจุงุณุชุฎุฏุงู **Indexed View** ูู ุนูุฏู ุงุณุชุนูุงู ุจูุชูุฑุฑ ูุชูุฑ ูุจูููู ูููู.
    
---
# 2) ุฅูุดุงุก View โ

```sql
CREATE VIEW view_name  -- ุจุนูู View ุฌุฏูุฏุฉ ูุจุฏูููุง ุงุณู (ูุซูุงู `v_Employees`).

AS -- ุงููููุฉ ุงูููุชุงุญูุฉ ุงููู ุจุนุฏูุง ูููุชุจ ุงูุงุณุชุนูุงู.

SELECT column1, column2, ...

FROM table_name --โ ุงูุงุณุชุนูุงู ุงููู ููุดุชุบู ูู ูุฑุฉ ูุณุชุฏุนู ุงูู View.

WHERE condition; --โ (ุงุฎุชูุงุฑู) ูู ุนุงูุฒ ุชุนุฑุถ ุฏุงุชุง ูุนููุฉ ููุท.
```

---

##### ูุซุงู 1 โ View ุจุณูุท ูุทูุงุจ ุงููุงูุฑุฉ
```sql
-- ุฅูุดุงุก ุฃู ุชุนุฏูู ููู ููุนูุฏ ุทูุงุจ ุงููุงูุฑุฉ
CREATE OR ALTER VIEW dbo.VCairoStudents
WITH ENCRYPTION  -- ุงุฎุชูุงุฑู: ูุฎูู ุงูููุฏ ุนูุฏ ุงุณุชุฎุฏุงู sp_helptext
AS
SELECT
    St_Id      AS [StudentCode],    -- ุฅุนุงุฏุฉ ุชุณููุฉ ุงูุนููุฏ ููุงุฌูุฉ ุฃุจุณุท
    St_Fname   AS [StudentName],
    St_Address AS [StudentAddress]
FROM dbo.Student
WHERE St_Address = 'Cairo';
GO

-- ูุฑุงุกุฉ ุงูุจูุงูุงุช ูู ุงูู View
SELECT * FROM dbo.VCairoStudents;
-- ููุงุญุธุฉ: ูู ูุด ูุดููุฑุ ุชูุฏุฑ ุชุดูู ุชุนุฑููู:
-- EXEC sp_helptext 'dbo.VCairoStudents';
```

**** ููุง ุงูู View ุจูุจูู ูุฌุฑุฏ ุงุฎุชุตุงุฑ ูุงุณุชุนูุงู `SELECT ... FROM Student WHERE St_Address='Cairo'`.  
ุฅุถุงูุฉ `WITH ENCRYPTION` ุชููุน ุฑุคูุฉ ุงููุต ุงููุตุฏุฑู (`sp_helptext`) ููู ุชูุฑุถ ูููุฏ (ูุชุจูุนุฉ ูุงุญูุงู).

ูุซุงู ุขุฎุฑ: ุงูุทูุงุจ ูู **Alex**:

``` SQL
CREATE OR ALTER VIEW dbo.VAlexStudents

 AS SELECT
	 St_Id,
	 St_Fname,
	 St_Address
	 
 FROM Student
 WHERE St_Address = 'Alex'; GO  
 -- ุงุณุชุนูุงู SELECT St_Fname, St_Address FROM dbo.VAlexStudents;
```

---

### ูุซุงู 2 โ View ูุน alias ูุฃุณูุงุก ุฃุนูุฏุฉ ููุฎุตูุตุฉ

```sql
-- ุฅุฎูุงุก ุฃุณูุงุก ุงูุฃุนูุฏุฉ ุงูุญููููุฉ ุนุจุฑ ุชุญุฏูุฏ ุฃุณูุงุก ุฌุฏูุฏุฉ ูู ุชุนุฑูู ุงูู View
CREATE OR ALTER VIEW dbo.VStudentsInDepartments
(
    StudentIDs,        -- ุงุณู ุจุฏู St_Id
    StudentNames,      -- ุงุณู ุจุฏู St_Fname
    DepartmentIDs,     -- ุงุณู ุจุฏู Dept_Id
    DepartmentNames    -- ุงุณู ุจุฏู Dept_Name
)
AS

SELECT
    S.St_Id,
    S.St_Fname,
    D.Dept_Id,
    D.Dept_Name
    
FROM dbo.Student AS S
INNER JOIN dbo.Department AS D
    ON S.Dept_Id = D.Dept_Id;
GO

-- ูุซุงู ุงุณุชุนูุงู
SELECT * FROM dbo.VStudentsInDepartments WHERE DepartmentNames = 'SD';
```

**:** ููุง ุจูุญุฏุฏ ุฃุณูุงุก ุงูุฃุนูุฏุฉ ูู ููุณูู ุจุนุฏ ุงุณู ุงูู View โ ุฏู ุทุฑููุฉ ุนูููุฉ ูุฅุฎูุงุก ุฃุณูุงุก ุงูุฃุนูุฏุฉ ุงูุญููููุฉ ุนู ุงููุณุชุฎุฏู.

---

### ูุซุงู 3 โ View ุจุถู (JOIN) ูุนุฑุถ ุฏุฑุฌุงุช ุงูุทูุจุฉ ูู ููุฑุณุงุช

```sql
--  ูุนุฑุถ ุงุณู ุงูุทุงูุจ + ุงุณู ุงูููุฑุณ + ุงูุฏุฑุฌุฉ + ูุนุฑู ุงููุณู
CREATE OR ALTER VIEW dbo.VStudentCourseGrades
AS

SELECT 
    Std.St_Fname   AS StudentName,
    Crs.Crs_Name   AS CourseName,
    StdCrs.Grade   AS StudentGrade,
    Std.Dept_Id    AS DeptID
    
FROM dbo.Student Std
INNER JOIN dbo.Stud_Course StdCrs ON Std.St_Id = StdCrs.St_Id
INNER JOIN dbo.Course Crs       ON Crs.Crs_Id = StdCrs.Crs_Id;
GO

```

---

# 3) ูุดุงูู ูุญุฏูุฏ ุงูู View โ 

- ุงู **ORDER BY** ุฏุงุฎู View ูุด ูุณููุญ **ุฅูุง** ูู ุงุณุชุฎุฏููุง : `SELECT TOP (10)  ... ORDER BY ...`
 ูุนูู ูุงุฒู ุชุญุฏุฏ ุนุฏุฏ ุงูุตููู ุจุงุณุชุฎุฏุงู `TOP` ูุน `ORDER BY` ุฏุงุฎู View
 
 - ุงูู View **ูุด** ูุนุฒูู (non-materialized)ุ ูุนูู ูู ุงูุงุณุชุนูุงู ุงูุฃุณุงุณู ุจุทูุกุ ุงูู View ููุจูู ุจุทูุก ุจุฑุถู.
- ูู ุงูู View ูุนุฑู ุจู `WITH ENCRYPTION` ูุด ูุชูุฏุฑ ุชุดูู ุชุนุฑููู ููุง ุชุนุฏููู ุจุณูููุฉ.
- ุงู**`ALTER SCHEMA`**: ุจูุณุชุฎุฏู ุนูุดุงู ุชููู  View ูู **Schema ูุขุฎุฑ ุฌูู ููุณ ุงูู Database**.

---

# 5) ุงูุชุดููุฑ (`WITH ENCRYPTION`) ู`sp_helptext`

- `WITH ENCRYPTION` ูููุน ุนุฑุถ ุชุนุฑูู ุงูู View ุนุจุฑ `sp_helptext` ุฃู ุงูุงุณุชุนุฑุงุถ ุนุจุฑ SSMS. ุงูุบุฑุถ: ุญูุงูุฉ Intellectual Property ุฃู ุฅุฎูุงุก ุงูุชูุงุตูู.
    
- **ุนููุจ/ูููุฏ**:
    
    - ุจุนุฏ ุงูุชุดููุฑ ูุด ูุชูุฏุฑ ุชุดูู ุงูููุฏ ุฃู ุชุนุฏููู ุจุณูููุฉ ุนุจุฑ ุงูุฃุฏูุงุช ุงูุนุงุฏูุฉ.
    - ูู ููุฏุช ุงูููุฏ ุงูุฃุตููุ ุฅุฒุงูุฉ ุงูุชุดููุฑ ุตุนุจุฉ ุฌุฏุงู (ูุด ููุฌูุฏุฉ ุฃุฏุงุฉ ุฑุณููุฉ ููู ุงูุชุดููุฑ).
    - ุงูุชุดููุฑ ูุง ูููุน ุงููุตูู ุฅูู ุงูุจูุงูุงุช ููุณูุง โ ููุท ูุฎูู ุงูู definition.

---

# 6) ููู View ุจูู Schemas ูDatabases โ 

- **ููู ุฏุงุฎู ููุณ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุจูู Schemas**:
    

```sql
-- ููู ุจูู schemas (ููุณ db)
ALTER SCHEMA HR TRANSFER dbo.VStudentsInDepartments;
-- ุฃู ุจุงูุนูุณ
ALTER SCHEMA dbo TRANSFER HR.VStudentsInDepartments;
```

###  7) ููู ุงูู View ุจูู ููุงุนุฏ ุจูุงูุงุช ูุฎุชููุฉ:

- **ุจูู ููุงุนุฏ ุจูุงูุงุช ูุฎุชููุฉ**: ูุงุฒู ุชุนูุฏ ุฅูุดุงุก ุงูู View ูู ุงูุฏุงุชุงุจูุฒ ุงูุชุงููุฉ:
    
    ```sql
CREATE VIEW VStudentsInDepartments AS SELECT * FROM MainDB.dbo.Student;
```
    
> ๐ก **ููุงุญุธุฉ:**  
> `ุงู dbo` ูุนูุงู **Database Owner** โ ุงูู Schema ุงูุงูุชุฑุงุถู ูุฃู ูุงุฆู ุฌุฏูุฏ ูู SQL Server.
    
---
## 8) ุงูุชุนุงูู ูุน DML ุนุจุฑ ุงูู View

* ูููู ุชุนูู `INSERT`, `UPDATE`, `DELETE` ุนูู View ูู ูุงู ุจุณูุท (ูุจูู ุนูู ุฌุฏูู ูุงุญุฏ).

* ูู ููู Joins ุฃู Aggregate Functions โ ูุด ููููุน.

ูุซุงู:

```sql

INSERT INTO dbo.VCairoStudents (StudentCode, StudentName, StudentAddress)

VALUES (101, 'Ali', 'Cairo');

-- ุชุญุฏูุซ ุงุณู ุทุงูุจ ูู ุฎูุงู ุงูู View
UPDATE dbo.VCairoStudents
SET StudentName = 'Ahmed'
WHERE StudentCode = 101;

-- ุญุฐู ุทุงูุจ ูู ุฎูุงู ุงูู View
DELETE FROM dbo.VCairoStudents
WHERE StudentCode = 101;

```

---

# 9) ุงููุฑู ุจูู `DELETE`, `TRUNCATE`, `DROP` 

| ุงูุฃูุฑ                              |                               ูุงุฐุง ููุนู |      ูู ููุณุญ ุงูุจููุฉุ       |  ูู ูุณุฌู ูู ุงูู Transaction Log ููู ุตูุ  | ููุงุญุธุงุช                                                     |
| ---------------------------------- | --------------------------------------: | :------------------------: | :--------------------------------------: | ----------------------------------------------------------- |
| `DELETE FROM ุงุณู ุงูุฌุฏูู WHERE ...` |                    ููุณุญ ุงูุตููู ุจุญุณุจ ุดุฑุท |             ูุง             |       **ูุนู** (ูุณุฌู ููู ุตูุ ุฃุจุทุฃ)        | ูููู ุงุณุชุฑุฌุงุนู ุจูุงุณุทุฉ ROLLBACK ุฏุงุฎู Transaction              |
| `TRUNCATE TABLE ุงุณู ุงูุฌุฏูู`        |                    ููุณุญ ูู ุงูุตููู ุจุณุฑุนุฉ | ูุง (ููู ููุณุญ ุงูุจูุงูุงุช ููุท) | ูุง ูุณุฌู ููู ุตู (ููุนูุฏ ุชุนููู ุตูุญุงุช), ุฃุณุฑุน | ูุง ูุนูู ุฅุฐุง ูู FK ูุนุชูุฏ ุนูู ุงูุฌุฏููุ ูุนูุฏ ุชุนููู ุงูู identity |
| `DROP TABLE ุงุณู ุงูุฌุฏูู`            | ูุญุฐู ุงูุฌุฏูู ุจุงููุงูู (ุงูุจููุฉ + ุงูุจูุงูุงุช) |            ูุนู             |          ูุณุฌู ุงูุนูููุฉ ุงูุจููููุฉ           | ูุง ูููู ุงูุชุฑุงุฌุน ุจุณูููุฉ ุฅูุง ุจุงุณุชุนุงุฏุฉ ูู Backup               |
